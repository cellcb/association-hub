### 用户自服务接口测试文件
### 用于测试用户个人档案管理功能

@baseUrl = {{baseUrl}}
@iamBase = {{baseUrl}}/api/iam

### 1. 登录获取token
POST {{iamBase}}/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "123456",
  "tenantId": 1
}

> {%
client.global.set("token", response.body.data.token);
console.log("Login successful, user info:", JSON.stringify(response.body.data.user, null, 2));
%}

### 2. 获取个人档案信息
GET {{iamBase}}/profile
Authorization: Bearer {{token}}

### 3. 更新个人档案信息
PUT {{iamBase}}/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "email": "updated-admin@example.com",
  "phone": "13900139000",
  "realName": "更新后的管理员"
}

### 4. 修改个人密码
POST {{iamBase}}/profile/change-password
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "oldPassword": "123456",
  "newPassword": "newPassword123",
  "confirmPassword": "newPassword123"
}

### 5. 获取个人权限信息
GET {{iamBase}}/profile/permissions
Authorization: Bearer {{token}}

### 6. 检查邮箱可用性（当前用户的邮箱）
GET {{iamBase}}/profile/check-email?email=admin@waterplatform.com
Authorization: Bearer {{token}}

### 7. 检查邮箱可用性（其他邮箱）
GET {{iamBase}}/profile/check-email?email=test@example.com
Authorization: Bearer {{token}}

### 8. 检查邮箱可用性（已被占用的邮箱）
GET {{iamBase}}/profile/check-email?email=existing@example.com
Authorization: Bearer {{token}}

### 边界测试：尝试访问管理员接口（应该失败，如果当前用户没有管理员权限）

### 9. 尝试创建用户（管理员功能）
POST {{iamBase}}/users
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "username": "testuser",
  "password": "password123",
  "email": "testuser@example.com",
  "realName": "测试用户"
}

### 10. 尝试获取所有用户列表（管理员功能）
GET {{iamBase}}/users
Authorization: Bearer {{token}}

### 11. 尝试删除用户（管理员功能）
DELETE {{iamBase}}/users/999
Authorization: Bearer {{token}}
